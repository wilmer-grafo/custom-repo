La tabla request_process_aux se mantiene

OBTENER EL CSV SQL SERVER
--------------------------- 

SELECT (SELECT TOP 1 da.id
        FROM request_process_aux da
        WHERE da.numero_recurso_alzada = temp.id_solicitud_proceso) AS id_solicitud_proceso,
       id_usuario_origen,
       id_usuario_destino,
       fecha_accion,
       ruta_adjunto,
       estado,
       id_proceso,
       observaciones
FROM (SELECT (CAST(ct.gestion AS varchar) + ';' +
              (CASE
                   WHEN LEN(LTRIM(RTRIM(ct.id_exp))) > 20 THEN
                       SUBSTRING(LTRIM(RTRIM(ct.id_exp)), 0, CHARINDEX('//', LTRIM(RTRIM(ct.id_exp))))
                   ELSE
                       LTRIM(RTRIM(ct.id_exp))
                  END)
    + ';' +
              (
                  CAST((SELECT ori.id_value
                        FROM origenes AS ori
                        WHERE ori.usuario_origen = LTRIM(RTRIM(ct.u_solicita))) as VARCHAR)
                  )
    + ';' +
              SUBSTRING(CONVERT(varchar, ct.f_solicita, 120), 1, 19)) AS id_solicitud_proceso,
             (SELECT ori.id_value
              FROM origenes AS ori
              WHERE ori.usuario_origen = LTRIM(RTRIM(ct.u_solicita))) AS id_usuario_origen,
             (CASE
                  WHEN (SELECT rec.id_value
                        FROM origenes AS rec
                        WHERE rec.usuario_origen = LTRIM(RTRIM(ct.u_aprueba_rechaza_sd))) IS NULL THEN 238
                  ELSE
                      (SELECT rec.id_value
                       FROM origenes AS rec
                       WHERE rec.usuario_origen = LTRIM(RTRIM(ct.u_aprueba_rechaza_sd)))
                 END)                                                 AS id_usuario_destino,
             (CASE
                  WHEN ct.f_aprueba_rechaza_sd IS NULL THEN ct.f_solicita
                  ELSE ct.f_aprueba_rechaza_sd
                 END)                                                 AS fecha_accion,
             NULL                                                     AS ruta_adjunto,
             20                                                       AS estado,
             (
                 CASE
                     WHEN ct.estado = 1 THEN 15
                     WHEN ct.estado = 2 THEN 16
                     ELSE 15
                     END)                                             AS id_proceso,
             NULL                                                     AS observaciones,
             ct.id
      FROM solicitud_excusa ct) AS temp
ORDER BY temp.id;






