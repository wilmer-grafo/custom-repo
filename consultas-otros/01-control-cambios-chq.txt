SELECT (CASE
            WHEN LEN(LTRIM(RTRIM(ct.id_exp))) > 20 THEN
                (SELECT id
                 FROM recursos AS r
                 WHERE r.numero_recurso_alzada =
                       SUBSTRING(LTRIM(RTRIM(ct.id_exp)), 0, CHARINDEX('//', LTRIM(RTRIM(ct.id_exp)))))
            ELSE
                (SELECT id FROM recursos AS r WHERE r.numero_recurso_alzada = LTRIM(RTRIM(ct.id_exp)))
    END)                                                                                                 AS id_recurso_alzada,
       (CASE
            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'DEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'DEJ')
                THEN 25

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'DEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'JURIDICO')
                THEN 8

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'DEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'SCAMARA')
                THEN 27

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'DEJ'
                    AND ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'SEJ')
                THEN 10

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'DEJ'
                    AND ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'TECNICO')
                THEN 8

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'EJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'ACAMARA')
                THEN 27


            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'EJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'EJ')
                THEN 3

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'EJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'JURIDICO')
                THEN 4

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'EJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'SEJ')
                THEN 5

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'EJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'TECNICO')
                THEN 4

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'JURIDICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'ACAMARA')
                THEN 27

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'JURIDICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'DEJ')
                THEN 11

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'JURIDICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'EJ')
                THEN 2

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'JURIDICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'JURIDICO')
                THEN 3

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'JURIDICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'TECNICO')
                THEN 3


            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECREDEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'SEJ')
                THEN 10

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECREDEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'JURIDICO')
                THEN 8

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECREDEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'TECNICO')
                THEN 8

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECRESUB' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'DEJ')
                THEN 6

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECRESUB' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'JURIDICO')
                THEN 6

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECRESUB' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'SEJ')
                THEN 10

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECRESUB' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'TECNICO')
                THEN 6

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'SECRESUB' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'EJ')
                THEN 6

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'SEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'ACAMARA')
                THEN 27

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'SEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'DEJ')
                THEN 7

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'SEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'JURIDICO')
                THEN 6

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'SEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'SEJ')
                THEN 5

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'SEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'TECNICO')
                THEN 6

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') = 'SEJ' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'EJ')
                THEN 6

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'TECNICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'ACAMARA')
                THEN 27

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'TECNICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'DEJ')
                THEN 11

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'TECNICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'EJ')
                THEN 2

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'TECNICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'JURIDICO')
                THEN 3

            WHEN (
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.origen), 'ACAMARA') =
                        'TECNICO' AND
                        ISNULL((SELECT u.cargo FROM usuario AS u WHERE u.id_user = ct.destino), 'ACAMARA') = 'TECNICO')
                THEN 3

            ELSE 1
           END)                                                                                          AS id_proceso,
       1                                                                                                 AS id_tramite,
       (SELECT ori.id_value
        FROM origenes AS ori
        WHERE ori.usuario_origen = LTRIM(RTRIM(ct.origen)))                                              AS id_usuario_origen,
       (SELECT dest.id_value
        FROM origenes AS dest
        WHERE dest.usuario_origen = LTRIM(RTRIM(ct.destino)))                                            AS id_usuario_destino,
       (CASE
            WHEN ct.f_recepcion = '1900-01-01 00:00:00.000' THEN NULL
            ELSE ct.f_recepcion
           END)                                                                                          AS fecha_recepcion,
       (CASE
            WHEN ct.f_inicio = '1900-01-01 00:00:00.000' THEN NULL
            ELSE ct.f_inicio
           END)                                                                                          AS fecha_inicio,
       (CASE
            WHEN ct.f_deriva = '1900-01-01 00:00:00.000' THEN NULL
            ELSE ct.f_deriva
           END)                                                                                          AS fecha_deriva,
       NULL                                                                                              AS id_tipo_observacion,
       20                                                                                                AS estado,
       (CASE
            WHEN LEN(LTRIM(RTRIM(ct.observaciones))) = 0 THEN NULL
            ELSE LTRIM(RTRIM(ct.observaciones))
           END)                                                                                          AS observaciones,
       NULL                                                                                              AS id_aclaracion
FROM control_tiempo AS ct
WHERE (LTRIM(RTRIM(ct.id_exp)) LIKE 'ARIT-CHQ-%/2021%' OR
       LTRIM(RTRIM(ct.id_exp)) LIKE 'ARIT-CHQ-%/2022%')
ORDER BY ct.id;
