EL excel de postgres se mantiene

EXCEL


SELECT (CAST(ct.gestion AS varchar) + ';' +
        (CASE
             WHEN LEN(LTRIM(RTRIM(ct.id_exp))) > 20 THEN
                 SUBSTRING(LTRIM(RTRIM(ct.id_exp)), 0, CHARINDEX('//', LTRIM(RTRIM(ct.id_exp))))
             ELSE
                 LTRIM(RTRIM(ct.id_exp))
            END)
    + ';' +
        (
            CAST((SELECT ori.id_value
                  FROM origenes AS ori
                  WHERE ori.usuario_origen = LTRIM(RTRIM(ct.u_solicita))) as VARCHAR)
            )
    + ';' +
        SUBSTRING(CONVERT(varchar, ct.f_solicita, 120), 1, 19))           AS id_solicitud_proceso,
       (SELECT ori.id_value
        FROM origenes AS ori
        WHERE ori.usuario_origen = LTRIM(RTRIM(ct.u_solicita)))           AS id_usuario_origen,
       (SELECT rec.id_value
        FROM origenes AS rec
        WHERE rec.usuario_origen = LTRIM(RTRIM(ct.u_aprueba_rechaza_sd))) AS id_usuario_destino,
       (CASE
            WHEN ct.f_aprueba_rechaza_sd IS NULL THEN ct.f_solicita
            ELSE ct.f_aprueba_rechaza_sd
           END)                                                           AS fecha_accion,
       NULL                                                               AS ruta_adjunto,
       20                                                                 AS estado,
       (
           CASE
               WHEN ct.estado = 1 THEN 15
               WHEN ct.estado = 2 THEN 16
               ELSE 15
               END)                                                       AS id_proceso,
       NULL                                                               AS observaciones
FROM solicitud_excusa ct
WHERE (LTRIM(RTRIM(id_exp)) LIKE 'ARIT-SCZ-%/2021%' OR
       LTRIM(RTRIM(id_exp)) LIKE 'ARIT-SCZ-%/2022%')
ORDER BY ct.id;


LAST 

SELECT (CAST(ct.gestion AS varchar) + ';' +
        (CASE
             WHEN LEN(LTRIM(RTRIM(ct.id_exp))) > 20 THEN
                 SUBSTRING(LTRIM(RTRIM(ct.id_exp)), 0, CHARINDEX('//', LTRIM(RTRIM(ct.id_exp))))
             ELSE
                 LTRIM(RTRIM(ct.id_exp))
            END)
    + ';' +
        (
            CAST((SELECT ori.id_value
                  FROM origenes AS ori
                  WHERE ori.usuario_origen = LTRIM(RTRIM(ct.u_solicita))) as VARCHAR)
            )
    + ';' +
        SUBSTRING(CONVERT(varchar, ct.f_solicita, 120), 1, 19)) AS id_solicitud_proceso,
       (SELECT ori.id_value
        FROM origenes AS ori
        WHERE ori.usuario_origen = LTRIM(RTRIM(ct.u_solicita))) AS id_usuario_origen,
       (CASE
            WHEN (SELECT rec.id_value
                  FROM origenes AS rec
                  WHERE rec.usuario_origen = LTRIM(RTRIM(ct.u_aprueba_rechaza_sd))) IS NULL THEN 238
            ELSE
                (SELECT rec.id_value
                 FROM origenes AS rec
                 WHERE rec.usuario_origen = LTRIM(RTRIM(ct.u_aprueba_rechaza_sd)))
           END)                                                 AS id_usuario_destino,
       (CASE
            WHEN ct.f_aprueba_rechaza_sd IS NULL THEN ct.f_solicita
            ELSE ct.f_aprueba_rechaza_sd
           END)                                                 AS fecha_accion,
       NULL                                                     AS ruta_adjunto,
       20                                                       AS estado,
       (
           CASE
               WHEN ct.estado = 1 THEN 15
               WHEN ct.estado = 2 THEN 16
               ELSE 15
               END)                                             AS id_proceso,
       NULL                                                     AS observaciones
FROM solicitud_excusa ct
WHERE (LTRIM(RTRIM(id_exp)) LIKE 'ARIT-LPZ-%/%' OR
       LTRIM(RTRIM(id_exp)) LIKE 'ARIT-LPZ-%/%')
ORDER BY ct.id;
